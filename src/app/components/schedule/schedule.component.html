<app-loader [loading]="loading()" />

<div class="actions">
  <form [formGroup]="dateFrom" class="actions">
    <div class="action-buttons">
      <button mat-icon-button (click)="prevMonth()" type="button">
        <mat-icon>keyboard_arrow_left</mat-icon>
      </button>
      <button mat-icon-button (click)="nextMonth()" type="button">
        <mat-icon>keyboard_arrow_right</mat-icon>
      </button>
    </div>
    <div class="action-buttons">
      <mat-form-field appearance="outline" id="month">
        <mat-label>Miesiące</mat-label>
        <mat-select formControlName="month">
          <mat-option [value]="0">Styczeń</mat-option>
          <mat-option [value]="1">Luty</mat-option>
          <mat-option [value]="2">Marzec</mat-option>
          <mat-option [value]="3">Kwiecień</mat-option>
          <mat-option [value]="4">Maj</mat-option>
          <mat-option [value]="5">Czerwiec</mat-option>
          <mat-option [value]="6">Lipiec</mat-option>
          <mat-option [value]="7">Sierpień</mat-option>
          <mat-option [value]="8">Wrzesień</mat-option>
          <mat-option [value]="9">Październik</mat-option>
          <mat-option [value]="10">Listopad</mat-option>
          <mat-option [value]="11">Grudzień</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline" id="year">
        <mat-label>Rok</mat-label>
        <input
          matInput
          type="number"
          min="2024"
          formControlName="year"
          size="4"
          maxlength="4"
        />
      </mat-form-field>
    </div>
  </form>
</div>
<div
  class="mat-elevation-z8 schedule"
  [style.gridTemplateColumns]="cssCols"
  (scroll)="onScroll($event)"
>
  <div class="col sticky-row sticky-col" style="z-index: 10">
    <div class="header">Imię Nazwisko</div>
  </div>
  @for (day of days; track day.day) {
  <div class="col sticky-row">
    <div class="header">
      {{ day.date | date : "EE dd/MM" }}
    </div>
  </div>
  } @for (row of rows; track row.workerName) {
  <div class="col sticky-col">
    <div
      class="data nowrap"
      [style.backgroundColor]="row.color"
      [style.color]="getTextColor(row.color)"
      (click)="goToWorker(row.id)"
    >
      {{ row.workerName }}
    </div>
  </div>
  @for (day of days; track day.day) { @if(row.days[day.day]) {
  <div class="col">
    @for (item of row.days[day.day]; track $index) {
    <div
      [style.backgroundColor]="item.color"
      [style.color]="getTextColor(item.color)"
      (click)="onClick(item)"
      class="data"
      [cdkContextMenuTriggerFor]="dayMenu"
      [cdkContextMenuTriggerData]="{ data: item }"
    >
      {{ item.eventName }}
    </div>
    }
  </div>
  } @else if (row.dayOffs[day.day]) {
  <div
    [style.backgroundColor]="'var(--sys-on-background)'"
    [style.color]="'var(--sys-background)'"
    class="data"
    [cdkContextMenuTriggerFor]="dayOffMenu"
    [cdkContextMenuTriggerData]="{ data: row.dayOffs[day.day] }"
  >
    Wolne
  </div>
  } @else {
  <div
    class="empty"
    [cdkContextMenuTriggerFor]="emptyMenu"
    [cdkContextMenuTriggerData]="{ data: day, worker: row }"
  ></div>
  } } }
</div>
<ng-template #dayMenu let-data="data">
  @if (admin()) {
  <div class="context-menu" cdkMenu>
    <button class="context-menu-item" cdkMenuItem (click)="removeDay(data)">
      Usuń
    </button>
    <button class="context-menu-item" cdkMenuItem (click)="duplicateDay(data)">
      Duplikuj
    </button>
  </div>
  }
</ng-template>

<ng-template #emptyMenu let-data="data" let-worker="worker">
  <div class="context-menu" cdkMenu>
    <button
      class="context-menu-item"
      cdkMenuItem
      (click)="addDayOff(worker, data)"
    >
      Dodaj Dzień wolny
    </button>
  </div>
</ng-template>

<ng-template #dayOffMenu let-data="data">
  <div class="context-menu" cdkMenu>
    <button class="context-menu-item" cdkMenuItem (click)="removeDayOff(data)">
      Usuń
    </button>
  </div>
</ng-template>
